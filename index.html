<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />

  <!-- üî• CLAVE PARA M√ìVIL -->
 

  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />

  <title>Airbnb AR Assistant</title>

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  

  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      font-family: sans-serif;
    }

    a-scene {
      position: fixed;
      inset: 0;
      z-index: 1;
    }

    /* üî• UI ENCIMA DEL AR */
    #ui {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 9999;
      display: flex;
      gap: 8px;
      background: rgba(0,0,0,0.7);
      padding: 10px;
      border-radius: 12px;
    }

    #ui input {
      width: 220px;
      padding: 10px;
      border-radius: 8px;
      border: none;
      font-size: 16px;
    }

    #ui button {
      padding: 10px 14px;
      border-radius: 8px;
      border: none;
      background: #00c853;
      color: #fff;
      font-weight: bold;
      font-size: 16px;
    }
  </style>
</head>

<body>

  <!-- ESCENA AR -->
<a-scene
  vr-mode-ui="enabled: false"
  embedded
  arjs="sourceType: webcam; facingMode: environment; debugUIEnabled: false;"
>

  <a-camera position="0 0 0" look-controls="enabled: false">

    <!-- CONTENEDOR FLOTANTE (ANIMADO) -->
    <a-entity
      id="arFloat"
      position="0 0 -2"
      animation="property: position;
                 dir: alternate;
                 dur: 3000;
                 easing: easeInOutSine;
                 loop: true;
                 to: 0 0.15 -2">

      <!-- PANEL AR (√öNICO) -->
      <a-entity
        id="arPanel"
        scale="0 0 0">

        <a-plane
          id="arPlane"
          width="1.8"
          height="1"
          color="#111"
          opacity="0.85">
        </a-plane>

        <a-text
          id="arText"
          value=""
          width="1.6"
          color="#FFFFFF"
          align="center"
          position="0 0 0.01"
          wrap-count="40">
        </a-text>

      </a-entity>

    </a-entity>

  </a-camera>

</a-scene>




  <!-- üî• UI HTML -->
  <div id="ui">
    <input
      id="questionInput"
      placeholder="Ej: ¬øA qu√© hora es el check-in?"
    />
    <button onclick="askAI()">Enviar</button>
  </div>
  <script>
  function getLanguageFromURL() {
    const params = new URLSearchParams(window.location.search);
    return params.get("lang");
  }

  function getBrowserLanguage() {
    return navigator.language || navigator.userLanguage || "es-ES";
  }

  function getCurrentLanguage() {
    return getLanguageFromURL() || getBrowserLanguage();
  }

  const CURRENT_LANG = getCurrentLanguage();
</script>

<script>
  const PROPERTY_CONFIG = {
  demo_property: {
    name: "Casa Playa Tamarindo",
    color: "#00c853",
    welcome: {
      es: "Bienvenido a Casa Playa Tamarindo üå¥",
      en: "Welcome to Casa Playa Tamarindo üå¥"
    }
  },
  hotel_demo: {
    name: "Hotel Para√≠so",
    color: "#2196f3",
    welcome: {
      es: "Bienvenido al Hotel Para√≠so üè®",
      en: "Welcome to Hotel Para√≠so üè®"
    }
  }
};


  function getPropertyFromURL() {
  const params = new URLSearchParams(window.location.search);
  return params.get("property") || "demo_property";
}

const CURRENT_PROPERTY = getPropertyFromURL();

</script>

  <script>
  let hideTimer = null;
  let currentUtterance = null;
 function applyBranding() {
  const config = PROPERTY_CONFIG[CURRENT_PROPERTY];
  if (!config) return;

  const plane = document.getElementById("arPlane");
  plane.setAttribute("color", config.color);

  const langKey = CURRENT_LANG.startsWith("en") ? "en" : "es";
  showARAnswer(config.welcome[langKey]);
}



  function speak(text) {
  if (currentUtterance) {
    window.speechSynthesis.cancel();
  }

  const utterance = new SpeechSynthesisUtterance(text);
  utterance.lang = CURRENT_LANG;
  utterance.rate = 0.95;
  utterance.pitch = 1;
  utterance.volume = 1;

  currentUtterance = utterance;
  window.speechSynthesis.speak(utterance);
}


    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = lang;
    utterance.rate = 0.95;
    utterance.pitch = 1;
    utterance.volume = 1;

    currentUtterance = utterance;
    window.speechSynthesis.speak(utterance);
  

  function detectLanguage(text) {
    const hasEnglish = /the|is|are|check/i.test(text);
   return hasEnglish ? "en-US" : "es-ES";
  }

  function showARAnswer(text) {
    const panel = document.getElementById("arPanel");
    const arText = document.getElementById("arText");

    arText.setAttribute("value", text);

    // Mostrar panel
    panel.setAttribute("scale", "1 1 1");

    // üîä HABLAR
    const lang = detectLanguage(text);
    speak(text, lang);

    // Cancelar ocultado previo
    if (hideTimer) {
      clearTimeout(hideTimer);
    }

    // Auto-ocultar despu√©s de 8s
    hideTimer = setTimeout(() => {
      panel.setAttribute("scale", "0 0 0");
    }, 8000);
  }

  async function askAI() {
    const input = document.getElementById("questionInput");
    if (!input.value) return;

    const res = await fetch(
      "https://gayla-subcalibre-destiny.ngrok-free.dev/ask",
      {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          property_id: CURRENT_PROPERTY,
          question: input.value,
          language: CURRENT_LANG
        })
      }
    );

    const data = await res.json();
    showARAnswer(data.answer);
    input.value = "";
   
  }
  //window.addEventListener("load", () => {
  //applyBranding();
//});
</script>
<script>
  window.addEventListener("load", () => {
    applyBranding();
  });
</script>



</body>
</html>
